# FileZilla Malware

## Introduction

Within the last week, the College of Fine Arts has received three security reports of quarantines caused by the popular FTP program, FileZilla. Two reports generated by Cisco AMP on the 14th and 16th of March contained hashes related to FileZilla. The third report also came on the 16th when a FAIT staff member downloaded FileZilla while on the utexas WiFi network and was immediately quarantined by ISO for a potential trojan variant. 

The series of three sequential incidents combined with the potential severity of the malware were concerning. So I did a little research and here is what I found. 

## FileZilla Potential Malware Analysis

Reports from a user, TigheW, on FileZilla’s forum and an article from Bleeping Computer, “FileZilla's Use Of Bundled Offers Sparks Outrage From Users”, indicate that the bundled FileZilla installer contains some variant of malware which operates by spawning a process to download individual, temporary .dat files and string them together into an executable which then reaches out over TCP port 80 to various domains not associated with FileZilla. 

User TigheW from the [FileZilla Forum](https://forum.filezilla-project.org/viewtopic.php?t=48441) (January 4, 2018): 

> I'm seeing hits on this file as well from advanced security tools in an enterprise environment. This appears to be a bit more than just a few false hits on VirusTotal. The installation of filezilla_3.29.0_win64-setup_bundled.exe file with MD5 of 9f405c266c883305537c11246bdb1d42 shows signs of malicious activity in the form of IDS/IPS bypass techniques to copy and append .dat files behind the scenes. This activity can sometimes be a false positive, but this does not appear to be a false hit.
> 
> The most suspicious part of the install we see is the spawning of an unsigned, unidentified process called tofufeti.exe which then spawns dozens of cmd.exe prompts to append these .dat files together after itself being put together by .dat file copy and appends.
> 
> See attached screenshot for the process chain we see spawning off of filezilla_3.29.0_win64-setup_bundled.exe. Each cmd.exe process expands into another chain of cmd.exe and conhost.exe processes to perform cleanup of the temp .dat files. None of this seems necessary for a simple FileZilla installation.
> 
> Can you comment on what exactly tofufeti.exe is and why this unique unsigned process is seen connecting to multiple IP's with no real content when installing the "clean" version of this software downloaded directly from the source?
> 
> The IP's and domains we see tofufeti.exe connecting to are:
>      54.225.173.220 on tcp/80 (goquc.com)
>      52.84.25.26 on tcp/80 (d39ievd5spb5kl.cloudfront.net)
>      34.208.177.52 on tcp/80 (gubuh.com)
> Random unsigned processes reaching out to random sites with no content over port 80 is typically a sign of malware beaconing.
> 
> Running the install without choosing any of the bundled adware shows no signs of this activity and is a simple and clean install that one would expect for a lightweight tool like FileZilla. So i don't think this is FileZilla's doing exactly, more that the bundled software in this bundle download appears to be typical adware garbage, but with a serious risk of turning into something far more severe via the ability to download other malicious files in small chunks and put them together after bypassing perimeter defenses. This technique is discussed in depth here: ([https://www.carbonblack.com/2016/09/23/ ... e-attacks/](https://www.carbonblack.com/2016/09/23/security-advisory-variants-well-known-adware-families-discovered-include-sophisticated-obfuscation-techniques-previously-associated-nation-state-attacks/))

[Bleeping Computer](https://www.bleepingcomputer.com/news/security/filezillas-use-of-bundled-offers-sparks-outrage-from-users/) (June 25, 2018): 

> This offer is called "Search Offer powered by Bing" and was displayed on every bundle install I performed of FileZilla … This offer is downloaded as individual .dat files into the %Temp% folder. A command is then executed to stitch these .dat files into a random looking executable, which is then executed.  This use of partial files almost makes it feel like they are doing it to avoid detecting by web protection components of security software.

From these reports, it seems that the FileZilla program itself may not be harmful, but the official bundled installers may contain software which is possibly dangerous. 

## Considerations
- The recent incidents have only affected Windows PCs. 
- There does not seem to be any indication that the Mac version of FileZilla is similarly compromised. 
- There are currently **17** Windows machines in COFA running filezilla.exe according to my LANrev report. 
- Three universities have banned FileZilla from their campuses: [University of Miami](https://security.it.miami.edu/stay-safe/sec-articles/filezilla-issues/index.html), [University of Washington](https://ciso.uw.edu/2018/07/18/filezilla-vulnerability/), [University of New Hampshire](https://www.unh.edu/it/news/2018/09/security-alert-filezilla-is-not-safe-for-use). 
- There are well-known FTP Alternatives: 
    - [Cyberduck](https://cyberduck.io/)
    - [WinSCP](https://winscp.net/eng/index.php)
## Conclusion

FileZilla’s official bundled installers contain adware at best and malware at worst. It is unknown whether the program itself behaves abnormally, further research is needed. The College of Fine Arts has identified three cases of FileZilla threats in the last week. Three other universities have determined FileZilla is dangerous enough to ban. I recommend we take similar precautions and begin to implement policy regarding FileZilla. 

## More Data

Two events were sent to us in from Cisco AMP which contained the following relevant hashes: 
* March 14, 2019 at 3:56 PM: 3fb8dc6d84333baa3b12f536c9620c3ad55ae9508c6ad2310fa897b720126186 https://www.virustotal.com/#/file/3fb8dc6d84333baa3b12f536c9620c3ad55ae9508c6ad2310fa897b720126186/detection
    Filename: FileZilla_3.39.0_win32-setup.exe
* March 16, 2019 at 05:37:23 UTC: 3129fd5421c1a71c0673f4cae5349b4a98d4e93da9c41ace1bcacdc9ebf9c0ff https://www.virustotal.com/#/file/3129fd5421c1a71c0673f4cae5349b4a98d4e93da9c41ace1bcacdc9ebf9c0ff/detection
    Filename: FileZilla_3.34.0_win32-setup.exe
Both hashes are related to two different versions of FileZilla and contain some sort of malware according the Virus Total reports. 

**LANrev Report - Search for Installed Software = filezilla** 

| **Agent Name** | **Computer Type** | **OS Platform**               | **OS Version** | **Agent Acitive IP** | **Current User Name** | **Installed Software** |
| -------------- | ----------------- | ----------------------------- | -------------- | -------------------- | --------------------- | ---------------------- |
| -              | PC Compatible     | Windows 7 64 Bit Enterprise   | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows XP Professional       | 5.1            | -                    |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            |                      |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 64 Bit Enterprise   | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            |                      |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 64 Bit Enterprise   | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 64 Bit Enterprise   | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 64 Bit Enterprise   | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 64 Bit Professional | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 10 Enterprise 64 Bit  | 10             | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    |                       | filezilla.exe          |
| -              | PC Compatible     | Windows 10 Enterprise 64 Bit  | 10             | -                    | -                     | filezilla.exe          |
| -              | PC Compatible     | Windows 7 Enterprise          | 6.1            | -                    |                       | filezilla.exe          |



